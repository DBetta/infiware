image: openjdk:8

pipelines:
  branches:
    develop:
      - step:
          name: Build with gradle, Create & Push images to a Docker Registry
          caches:
            - gradle
            - docker
          script:
            - ci/dependencies.sh
            - bash ./gradlew build -x test
            - docker-compose build
            - docker login $DOCKER_REPOSITORY --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
            - docker push $DOCKER_REPOSITORY bomapoint/gateway
            - docker push $DOCKER_REPOSITORY bomapoint/uaa
          services:
            - docker
